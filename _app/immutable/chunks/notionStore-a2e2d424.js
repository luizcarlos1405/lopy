import{w as l}from"./index-a5fb40b1.js";const t={token:localStorage.getItem("token"),pageId:localStorage.getItem("pageId"),transactionsDatabaseId:localStorage.getItem("transactionsDatabaseId"),envelopesDatabaseId:localStorage.getItem("envelopesDatabaseId"),apiEndpoint:"https://lopy-notion-api.deno.dev/api/"},d=l({envelopes:[]}),h=async()=>{const e=new Headers;e.append("procedure","listEnvelopes"),e.append("Authorization",`Bearer ${t.token}`),e.append("Content-Type","application/json");const o=JSON.stringify({envelopesDatabaseId:t.envelopesDatabaseId}),n={method:"POST",headers:e,body:o},s=await fetch(`${t.apiEndpoint}notion-procedures`,n).then(a=>a.json()).catch(a=>(console.error(a),[]));d.update(a=>({...a,envelopes:s}))},I=async({envelopeId:e})=>{const o=new Headers;o.append("procedure","listEnvelopeTransactions"),o.append("Authorization",`Bearer ${t.token}`),o.append("Content-Type","application/json");const n=JSON.stringify({transactionsDatabaseId:t.transactionsDatabaseId,envelopePageId:e}),s={method:"POST",headers:o,body:n},a=await fetch(`${t.apiEndpoint}notion-procedures`,s).then(p=>p.json()).catch(p=>(console.error(p),[]));d.update(p=>({...p,transactionsByEnvelopeId:{...p.transactionsByEnvelopeId,[e]:a}}))},y=async({envelopeId:e,transaction:o})=>{d.update(n=>{const s=new Headers;s.append("procedure","addTransaction"),s.append("Authorization",`Bearer ${t.token}`),s.append("Content-Type","application/json");const a=JSON.stringify({transactionsDatabaseId:t.transactionsDatabaseId,envelopePageId:e,comment:o.comment||"",value:o.value/100}),p={method:"POST",headers:s,body:a};fetch(`${t.apiEndpoint}notion-procedures`,p).then(i=>i.json()).catch(i=>{console.error(i),d.update(()=>n)});const c=n.envelopes.findIndex(({_id:i})=>i===e);if(c<0)return n;const r=[{_id:`optimistic-ui-${Math.random()}`,date:new Date().getTime(),...o},...n.transactionsByEnvelopeId[e]];return n.envelopes[c].value+=o.value,{...n,envelopes:n.envelopes,transactionsByEnvelopeId:{...n.transactionsByEnvelopeId,[e]:r}}})};export{I as a,t as c,h as f,d as n,y as s};
