var Pe=Object.defineProperty,Ae=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var de=(t,n,e)=>n in t?Pe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,ie=(t,n)=>{for(var e in n||(n={}))me.call(n,e)&&de(t,e,n[e]);if(le)for(var e of le(n))_e.call(n,e)&&de(t,e,n[e]);return t},ue=(t,n)=>Ae(t,Se(n));var ce=(t,n)=>{var e={};for(var o in t)me.call(t,o)&&n.indexOf(o)<0&&(e[o]=t[o]);if(t!=null&&le)for(var o of le(t))n.indexOf(o)<0&&_e.call(t,o)&&(e[o]=t[o]);return e};import{S as Te,i as Ee,s as Ne,ap as Ce,Q as De,e as B,w as Y,k as j,c as P,a as A,x as F,m as q,d as g,b as v,a1 as X,g as W,H as b,y as K,an as se,T as M,q as O,o as R,B as Q,V as pe,aq as Oe,M as ee,a6 as he,t as te,h as ne,a7 as Me,p as Ie,L as fe,n as Be,ar as be,a5 as ge,N as C,am as oe,ao as re,ab as Re,as as ve,at as ze,au as Ve,av as Ue,ah as ke}from"../../chunks/vendor-330cf7b4.js";import{f as je,s as qe,i as Le,C as ye,a as We,e as He,p as Xe}from"../../chunks/stores-fe43886f.js";import{E as Ye}from"../../chunks/EnvelopeTransactions-cf17085b.js";import{E as Fe}from"../../chunks/Envelope-f6548ab2.js";import"../../chunks/singletons-d1fb5791.js";import"../../chunks/longpress-a7a6c534.js";function Ke(t){let n,e,o,a,i,d,l,r,c,w;return o=new Ce({props:{class:"swap-on",size:"24"}}),i=new De({props:{class:"swap-off",size:"24"}}),{c(){n=B("div"),e=B("div"),Y(o.$$.fragment),a=j(),Y(i.$$.fragment),d=j(),l=B("input"),this.h()},l(p){n=P(p,"DIV",{class:!0});var _=A(n);e=P(_,"DIV",{class:!0});var k=A(e);F(o.$$.fragment,k),a=q(k),F(i.$$.fragment,k),k.forEach(g),d=q(_),l=P(_,"INPUT",{class:!0,inputmode:!0}),_.forEach(g),this.h()},h(){v(e,"class","swap swap-rotate relative cursor-pointer p-1 svelte-19elewz"),X(e,"minus",t[2]),X(e,"plus",!t[2]),v(l,"class","reset-input font-mono input-xs flex-grow text-base-content"),l.autofocus=!0,v(l,"inputmode","numeric"),v(n,"class","flex min-h-max w-full items-center overflow-clip rounded-full bg-base-200 text-neutral-content")},m(p,_){W(p,n,_),b(n,e),K(o,e,null),b(e,a),K(i,e,null),b(n,d),b(n,l),se(l,t[3]),t[9](l),r=!0,l.focus(),c||(w=[M(e,"click",t[7]),M(l,"change",t[5]),M(l,"selectionchange",t[6]),M(l,"input",t[8]),M(l,"input",t[5]),M(l,"keyup",t[4])],c=!0)},p(p,[_]){_&4&&X(e,"minus",p[2]),_&4&&X(e,"plus",!p[2]),_&8&&l.value!==p[3]&&se(l,p[3])},i(p){r||(O(o.$$.fragment,p),O(i.$$.fragment,p),r=!0)},o(p){R(o.$$.fragment,p),R(i.$$.fragment,p),r=!1},d(p){p&&g(n),Q(o),Q(i),t[9](null),c=!1,pe(w)}}}function Qe(t,n,e){let o,{inputRef:a=null}=n,{value:i=0}=n,{isNegative:d=!1}=n;const l=Oe(),r=({key:h})=>{h==="Enter"&&l("enterPressed")},c=h=>{h.preventDefault();const T=+`${qe(o)}`;e(0,i=d?-T:T)},w=h=>{const T=h.target.value.length;h.target.selectionEnd=T,h.target.selectionStart=T},p=()=>{e(2,d=!d),e(0,i=d?-Math.abs(i):Math.abs(i)),a==null||a.focus()};function _(){o=this.value,e(3,o),e(0,i)}function k(h){ee[h?"unshift":"push"](()=>{a=h,e(1,a)})}return t.$$set=h=>{"inputRef"in h&&e(1,a=h.inputRef),"value"in h&&e(0,i=h.value),"isNegative"in h&&e(2,d=h.isNegative)},t.$$.update=()=>{t.$$.dirty&1&&e(3,o=je(Math.abs(i),{showSign:!1}))},[i,a,d,o,r,c,w,p,_,k]}class Ge extends Te{constructor(n){super();Ee(this,n,Qe,Ke,Ne,{inputRef:1,value:0,isNegative:2})}}function Je(t){return{c:C,l:C,m:C,p:C,i:C,o:C,d:C}}function Ze(t){let n,e,o,a;function i(l){t[17](l)}let d={transactions:t[27]};return t[5]!==void 0&&(d.selectedTransactionsById=t[5]),e=new Ye({props:d}),ee.push(()=>oe(e,"selectedTransactionsById",i)),{c(){n=B("span"),Y(e.$$.fragment),this.h()},l(l){n=P(l,"SPAN",{class:!0});var r=A(n);F(e.$$.fragment,r),r.forEach(g),this.h()},h(){v(n,"class","col-start-2 col-end-12 mb-4")},m(l,r){W(l,n,r),K(e,n,null),a=!0},p(l,r){const c={};r&16&&(c.transactions=l[27]),!o&&r&32&&(o=!0,c.selectedTransactionsById=l[5],re(()=>o=!1)),e.$set(c)},i(l){a||(O(e.$$.fragment,l),a=!0)},o(l){R(e.$$.fragment,l),a=!1},d(l){l&&g(n),Q(e)}}}function $e(t){return{c:C,l:C,m:C,p:C,i:C,o:C,d:C}}function xe(t){var G;let n,e=t[2]||((G=Object.keys(t[5]))==null?void 0:G.length),o,a,i,d,l,r,c,w,p,_,k,h,T,z,L,y,E,N,V,m=e&&we(t);d=new ze({props:{size:"20",strokeWidth:"3"}}),w=new Ve({props:{size:"20",strokeWidth:"3"}});function Z(s){t[20](s)}function I(s){t[21](s)}function $(s){t[22](s)}let D={};return t[7]!==void 0&&(D.isNegative=t[7]),t[6].value!==void 0&&(D.value=t[6].value),t[1]!==void 0&&(D.inputRef=t[1]),k=new Ge({props:D}),ee.push(()=>oe(k,"isNegative",Z)),ee.push(()=>oe(k,"value",I)),ee.push(()=>oe(k,"inputRef",$)),k.$on("enterPressed",t[10]),{c(){n=B("div"),m&&m.c(),o=j(),a=B("span"),i=B("button"),Y(d.$$.fragment),l=te(`
            Delete`),r=j(),c=B("button"),Y(w.$$.fragment),p=te(`
            Paste`),_=j(),Y(k.$$.fragment),L=j(),y=B("textarea"),this.h()},l(s){n=P(s,"DIV",{class:!0});var f=A(n);m&&m.l(f),o=q(f),a=P(f,"SPAN",{class:!0});var u=A(a);i=P(u,"BUTTON",{class:!0});var S=A(i);F(d.$$.fragment,S),l=ne(S,`
            Delete`),S.forEach(g),r=q(u),c=P(u,"BUTTON",{class:!0});var U=A(c);F(w.$$.fragment,U),p=ne(U,`
            Paste`),U.forEach(g),u.forEach(g),f.forEach(g),_=q(s),F(k.$$.fragment,s),L=q(s),y=P(s,"TEXTAREA",{class:!0,id:!0,rows:!0,placeholder:!0}),A(y).forEach(g),this.h()},h(){v(i,"class","swap-on text-dark inline-flex gap-2 items-center font-bold rounded-full py-2 px-2"),v(c,"class","swap-off text-dark inline-flex gap-2 items-center font-bold rounded-full py-2 px-2"),v(a,"class","swap swap-flip svelte-eb6yxb"),X(a,"swapActive",Object.keys(t[5]).length),v(n,"class","inline-flex self-end gap-4"),v(y,"class","textarea bg-base-200 ease-linear leading-4 resize-none"),v(y,"id","comment-input"),v(y,"rows","3"),v(y,"placeholder","Description")},m(s,f){W(s,n,f),m&&m.m(n,null),b(n,o),b(n,a),b(a,i),K(d,i,null),b(i,l),b(a,r),b(a,c),K(w,c,null),b(c,p),W(s,_,f),K(k,s,f),W(s,L,f),W(s,y,f),se(y,t[6].comment),E=!0,N||(V=[M(i,"click",t[11]),M(c,"click",t[15]),M(y,"input",t[23])],N=!0)},p(s,f){var S;f&36&&(e=s[2]||((S=Object.keys(s[5]))==null?void 0:S.length)),e?m?(m.p(s,f),f&36&&O(m,1)):(m=we(s),m.c(),O(m,1),m.m(n,o)):m&&(Be(),R(m,1,1,()=>{m=null}),Ie()),f&32&&X(a,"swapActive",Object.keys(s[5]).length);const u={};!h&&f&128&&(h=!0,u.isNegative=s[7],re(()=>h=!1)),!T&&f&64&&(T=!0,u.value=s[6].value,re(()=>T=!1)),!z&&f&2&&(z=!0,u.inputRef=s[1],re(()=>z=!1)),k.$set(u),f&64&&se(y,s[6].comment)},i(s){E||(O(m),O(d.$$.fragment,s),O(w.$$.fragment,s),O(k.$$.fragment,s),E=!0)},o(s){R(m),R(d.$$.fragment,s),R(w.$$.fragment,s),R(k.$$.fragment,s),E=!1},d(s){s&&g(n),m&&m.d(),Q(d),Q(w),s&&g(_),Q(k,s),s&&g(L),s&&g(y),N=!1,pe(V)}}}function et(t){let n,e,o;return{c(){n=B("textarea"),this.h()},l(a){n=P(a,"TEXTAREA",{class:!0,id:!0,rows:!0,placeholder:!0}),A(n).forEach(g),this.h()},h(){v(n,"class","textarea resize-none self-stretch bg-base-200 leading-4 ease-linear"),v(n,"id","comment-input"),v(n,"rows","7"),v(n,"placeholder","Transactions")},m(a,i){W(a,n,i),se(n,t[8]),t[19](n),e||(o=M(n,"input",t[18]),e=!0)},p(a,i){i&256&&se(n,a[8])},i:C,o:C,d(a){a&&g(n),t[19](null),e=!1,o()}}}function we(t){let n,e,o,a,i,d,l;return e=new Ue({props:{size:"20",strokeWidth:"3"}}),{c(){n=B("button"),Y(e.$$.fragment),o=te(`
            Copy`),this.h()},l(r){n=P(r,"BUTTON",{class:!0});var c=A(n);F(e.$$.fragment,c),o=ne(c,`
            Copy`),c.forEach(g),this.h()},h(){v(n,"class","text-dark inline-flex gap-2 items-center font-bold rounded-full py-2 px-2")},m(r,c){W(r,n,c),K(e,n,null),b(n,o),i=!0,d||(l=M(n,"click",t[14]),d=!0)},p:C,i(r){i||(O(e.$$.fragment,r),r&&Re(()=>{a||(a=ve(n,ke,{duration:300},!0)),a.run(1)}),i=!0)},o(r){R(e.$$.fragment,r),r&&(a||(a=ve(n,ke,{duration:300},!1)),a.run(0)),i=!1},d(r){r&&g(n),Q(e),r&&a&&a.end(),d=!1,l()}}}function tt(t){let n,e,o,a,i,d,l,r,c,w,p,_,k,h,T,z,L,y,E,N,V,m,Z;o=new Fe({props:{envelope:t[9]}});let I={ctx:t,current:null,token:null,hasCatch:!1,pending:$e,then:Ze,catch:Je,value:27,blocks:[,,,]};he(i=t[4].transactions,I);const $=[et,xe],D=[];function G(s,f){return s[3]?0:1}return r=G(t),c=D[r]=$[r](t),{c(){n=B("div"),e=B("span"),Y(o.$$.fragment),a=j(),I.block.c(),d=j(),l=B("div"),c.c(),w=j(),p=B("div"),_=B("button"),k=te("Back"),h=j(),T=B("button"),z=B("span"),L=te("Spend"),y=j(),E=B("span"),N=te("Save"),this.h()},l(s){n=P(s,"DIV",{class:!0});var f=A(n);e=P(f,"SPAN",{class:!0});var u=A(e);F(o.$$.fragment,u),u.forEach(g),a=q(f),I.block.l(f),d=q(f),l=P(f,"DIV",{class:!0});var S=A(l);c.l(S),w=q(S),p=P(S,"DIV",{class:!0});var U=A(p);_=P(U,"BUTTON",{class:!0});var H=A(_);k=ne(H,"Back"),H.forEach(g),h=q(U),T=P(U,"BUTTON",{class:!0});var J=A(T);z=P(J,"SPAN",{class:!0});var x=A(z);L=ne(x,"Spend"),x.forEach(g),y=q(J),E=P(J,"SPAN",{class:!0});var ae=A(E);N=ne(ae,"Save"),ae.forEach(g),J.forEach(g),U.forEach(g),S.forEach(g),f.forEach(g),this.h()},h(){v(e,"class","sticky top-4 z-10 col-start-2 col-end-12 my-4"),v(_,"class","w-22 btn btn-outline"),v(z,"class","swap-on"),v(E,"class","swap-off"),v(T,"class","w-22 btn swap btn-primary svelte-eb6yxb"),X(T,"swapActive",t[7]&&!t[3]),v(p,"class","flex justify-around"),v(l,"class","sticky bottom-0 col-span-full mt-8 box-border flex flex-col space-y-4 rounded-t-3xl bg-base-100 p-6"),v(n,"class","layout-template-rows grid-layout min-h-full svelte-eb6yxb")},m(s,f){W(s,n,f),b(n,e),K(o,e,null),b(n,a),I.block.m(n,I.anchor=null),I.mount=()=>n,I.anchor=d,b(n,d),b(n,l),D[r].m(l,null),b(l,w),b(l,p),b(p,_),b(_,k),b(p,h),b(p,T),b(T,z),b(z,L),b(T,y),b(T,E),b(E,N),V=!0,m||(Z=[M(_,"click",t[13]),M(T,"click",t[12])],m=!0)},p(s,[f]){t=s;const u={};f&512&&(u.envelope=t[9]),o.$set(u),I.ctx=t,f&16&&i!==(i=t[4].transactions)&&he(i,I)||Me(I,t,f);let S=r;r=G(t),r===S?D[r].p(t,f):(Be(),R(D[S],1,1,()=>{D[S]=null}),Ie(),c=D[r],c?c.p(t,f):(c=D[r]=$[r](t),c.c()),O(c,1),c.m(l,w)),f&136&&X(T,"swapActive",t[7]&&!t[3])},i(s){V||(O(o.$$.fragment,s),O(I.block),O(c),V=!0)},o(s){R(o.$$.fragment,s);for(let f=0;f<3;f+=1){const u=I.blocks[f];R(u)}R(c),V=!1},d(s){s&&g(n),Q(o),I.block.d(),I.token=null,I=null,D[r].d(),m=!1,pe(Z)}}}function nt(t,n,e){let o,a,i,d;fe(t,We,u=>e(24,a=u)),fe(t,He,u=>e(16,i=u)),fe(t,Xe,u=>e(25,d=u));const{id:l}=d.params;let r=null,c=null,w=null,p=!1;const _=()=>{document==null||document.getElementById("comment-input").focus()},k=async()=>{await a.deleteTransactions(Object.keys(E),l),e(5,E={}),e(4,y=await y.refresh())},h=()=>{if(p){const u=be.parse(m);e(8,m=""),e(3,p=!1),u==null||u.forEach(x=>{var ae=x,{envelope:S,value:U,date:H}=ae,J=ce(ae,["envelope","value","date"]);a.saveTransaction(ue(ie({},J),{value:U*100,date:ge.fromFormat(H,ye).toSeconds()}),l).then(async()=>{e(5,E={}),e(4,y=await y.refresh())})});return}Le()&&N.value&&a.saveTransaction(N,l).then(async u=>{e(6,N.value=0,N),e(6,N.comment="",N),e(4,y=await y.refresh()),c==null||c.focus(),e(2,w=u),e(5,E={})})},T=()=>{if(p){e(3,p=!1);return}window.history.back()},z=()=>{const u=w?[w]:Object.values(E);navigator.clipboard.writeText(be.stringify(u.map(J=>{var x=J,{envelopeId:S,_id:U}=x,H=ce(x,["envelopeId","_id"]);return ue(ie({envelope:o==null?void 0:o.name},H),{value:H.value/100,date:ge.fromSeconds(H.date).toFormat(ye)})}))).then(()=>{e(2,w=null),e(5,E={})}).catch(console.error)},L=async()=>{e(3,p=!0),r==null||r.focus()};let y=a?a.getTransactionsPaginated({actions:a,envelopeId:l}):{},E={},N={value:0,comment:""},V=!0,m="";function Z(u){E=u,e(5,E)}function I(){m=this.value,e(8,m)}function $(u){ee[u?"unshift":"push"](()=>{r=u,e(0,r)})}function D(u){V=u,e(7,V)}function G(u){t.$$.not_equal(N.value,u)&&(N.value=u,e(6,N))}function s(u){c=u,e(1,c)}function f(){N.comment=this.value,e(6,N)}return t.$$.update=()=>{t.$$.dirty&65536&&e(9,o=i.find(({_id:u})=>u===l)||{})},[r,c,w,p,y,E,N,V,m,o,_,k,h,T,z,L,i,Z,I,$,D,G,s,f]}class ct extends Te{constructor(n){super();Ee(this,n,nt,tt,Ne,{})}}export{ct as default};
