var De=Object.defineProperty,Oe=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var _e=(t,n,e)=>n in t?De(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,ue=(t,n)=>{for(var e in n||(n={}))he.call(n,e)&&_e(t,e,n[e]);if(le)for(var e of le(n))ge.call(n,e)&&_e(t,e,n[e]);return t},ce=(t,n)=>Oe(t,Se(n));var fe=(t,n)=>{var e={};for(var o in t)he.call(t,o)&&n.indexOf(o)<0&&(e[o]=t[o]);if(t!=null&&le)for(var o of le(t))n.indexOf(o)<0&&ge.call(t,o)&&(e[o]=t[o]);return e};import{S as Ne,i as Ae,s as Be,aq as Re,Q as Me,e as B,w as F,k as j,c as P,a as C,x as K,m as q,d as b,b as v,a1 as Y,g as H,H as g,y as Q,ao as ne,T as z,q as M,o as V,B as G,V as de,ar as ze,M as $,a6 as be,t as ee,h as te,a7 as Ve,p as Pe,L as pe,n as Ce,as as ve,a5 as ke,N as S,an as oe,ap as re,a8 as Ue,a9 as ye,at as je,au as qe,av as Le,aa as we}from"../../chunks/vendor-7e985693.js";import{f as Te,s as We,i as He,C as Ee,a as Xe,e as Ye,p as Fe}from"../../chunks/stores-207dda47.js";import{E as Ke}from"../../chunks/EnvelopeTransactions-e5ed5b79.js";import{E as Qe}from"../../chunks/Envelope-7b65f3be.js";import"../../chunks/singletons-d1fb5791.js";import"../../chunks/longpress-a7a6c534.js";function Ge(t){let n,e,o,a,i,m,s,r,c,y;return o=new Re({props:{class:"swap-on",size:"24"}}),i=new Me({props:{class:"swap-off",size:"24"}}),{c(){n=B("div"),e=B("div"),F(o.$$.fragment),a=j(),F(i.$$.fragment),m=j(),s=B("input"),this.h()},l(p){n=P(p,"DIV",{class:!0});var d=C(n);e=P(d,"DIV",{class:!0});var k=C(e);K(o.$$.fragment,k),a=q(k),K(i.$$.fragment,k),k.forEach(b),m=q(d),s=P(d,"INPUT",{class:!0,inputmode:!0}),d.forEach(b),this.h()},h(){v(e,"class","swap swap-rotate relative cursor-pointer p-1 svelte-19elewz"),Y(e,"minus",t[2]),Y(e,"plus",!t[2]),v(s,"class","reset-input font-mono input-xs flex-grow text-base-content"),s.autofocus=!0,v(s,"inputmode","numeric"),v(n,"class","flex min-h-max w-full items-center overflow-clip rounded-full bg-base-200 text-neutral-content")},m(p,d){H(p,n,d),g(n,e),Q(o,e,null),g(e,a),Q(i,e,null),g(n,m),g(n,s),ne(s,t[3]),t[9](s),r=!0,s.focus(),c||(y=[z(e,"click",t[7]),z(s,"change",t[5]),z(s,"selectionchange",t[6]),z(s,"input",t[8]),z(s,"input",t[5]),z(s,"keyup",t[4])],c=!0)},p(p,[d]){d&4&&Y(e,"minus",p[2]),d&4&&Y(e,"plus",!p[2]),d&8&&s.value!==p[3]&&ne(s,p[3])},i(p){r||(M(o.$$.fragment,p),M(i.$$.fragment,p),r=!0)},o(p){V(o.$$.fragment,p),V(i.$$.fragment,p),r=!1},d(p){p&&b(n),G(o),G(i),t[9](null),c=!1,de(y)}}}function Je(t,n,e){let{inputRef:o=null}=n,{value:a=0}=n,{isNegative:i=!1}=n;const m=ze();let s=Te(a);const r=({key:h})=>{h==="Enter"&&m("enterPressed")},c=h=>{h.preventDefault();const w=+`${We(s)}`;e(1,a=i?-w:w),e(3,s=Te(Math.abs(a),{showSign:!1}))},y=h=>{const w=h.target.value.length;h.target.selectionEnd=w,h.target.selectionStart=w},p=()=>{e(2,i=!i),e(1,a=i?-Math.abs(a):Math.abs(a)),o==null||o.focus()};function d(){s=this.value,e(3,s)}function k(h){$[h?"unshift":"push"](()=>{o=h,e(0,o)})}return t.$$set=h=>{"inputRef"in h&&e(0,o=h.inputRef),"value"in h&&e(1,a=h.value),"isNegative"in h&&e(2,i=h.isNegative)},[o,a,i,s,r,c,y,p,d,k]}class Ze extends Ne{constructor(n){super();Ae(this,n,Je,Ge,Be,{inputRef:0,value:1,isNegative:2})}}function $e(t){return{c:S,l:S,m:S,p:S,i:S,o:S,d:S}}function xe(t){let n,e,o,a;function i(s){t[18](s)}let m={transactions:t[30]};return t[6]!==void 0&&(m.selectedTransactionsById=t[6]),e=new Ke({props:m}),$.push(()=>oe(e,"selectedTransactionsById",i)),{c(){n=B("span"),F(e.$$.fragment),this.h()},l(s){n=P(s,"SPAN",{class:!0});var r=C(n);K(e.$$.fragment,r),r.forEach(b),this.h()},h(){v(n,"class","col-start-2 col-end-12 mb-4")},m(s,r){H(s,n,r),Q(e,n,null),a=!0},p(s,r){const c={};r&32&&(c.transactions=s[30]),!o&&r&64&&(o=!0,c.selectedTransactionsById=s[6],re(()=>o=!1)),e.$set(c)},i(s){a||(M(e.$$.fragment,s),a=!0)},o(s){V(e.$$.fragment,s),a=!1},d(s){s&&b(n),G(e)}}}function et(t){return{c:S,l:S,m:S,p:S,i:S,o:S,d:S}}function tt(t){var J;let n,e=t[3]||((J=Object.keys(t[6]))==null?void 0:J.length),o,a,i,m,s,r,c,y,p,d,k,h,w,U,L,E,I,D,T,_=e&&Ie(t);m=new je({props:{size:"20",strokeWidth:"3"}}),y=new qe({props:{size:"20",strokeWidth:"3"}});function W(l){t[21](l)}function N(l){t[22](l)}function x(l){t[23](l)}let R={};return t[8]!==void 0&&(R.isNegative=t[8]),t[7].value!==void 0&&(R.value=t[7].value),t[1]!==void 0&&(R.inputRef=t[1]),k=new Ze({props:R}),$.push(()=>oe(k,"isNegative",W)),$.push(()=>oe(k,"value",N)),$.push(()=>oe(k,"inputRef",x)),k.$on("enterPressed",t[11]),{c(){n=B("div"),_&&_.c(),o=j(),a=B("span"),i=B("button"),F(m.$$.fragment),s=ee(`
            Delete`),r=j(),c=B("button"),F(y.$$.fragment),p=ee(`
            Paste`),d=j(),F(k.$$.fragment),L=j(),E=B("textarea"),this.h()},l(l){n=P(l,"DIV",{class:!0});var u=C(n);_&&_.l(u),o=q(u),a=P(u,"SPAN",{class:!0});var A=C(a);i=P(A,"BUTTON",{class:!0});var O=C(i);K(m.$$.fragment,O),s=te(O,`
            Delete`),O.forEach(b),r=q(A),c=P(A,"BUTTON",{class:!0});var f=C(c);K(y.$$.fragment,f),p=te(f,`
            Paste`),f.forEach(b),A.forEach(b),u.forEach(b),d=q(l),K(k.$$.fragment,l),L=q(l),E=P(l,"TEXTAREA",{class:!0,id:!0,rows:!0,placeholder:!0}),C(E).forEach(b),this.h()},h(){v(i,"class","swap-on text-dark inline-flex gap-2 items-center font-bold rounded-full py-2 px-2"),v(c,"class","swap-off text-dark inline-flex gap-2 items-center font-bold rounded-full py-2 px-2"),v(a,"class","swap swap-flip svelte-eb6yxb"),Y(a,"swapActive",Object.keys(t[6]).length),v(n,"class","inline-flex self-end gap-4"),v(E,"class","textarea bg-base-200 ease-linear leading-4 resize-none"),v(E,"id","comment-input"),v(E,"rows","3"),v(E,"placeholder","Description")},m(l,u){H(l,n,u),_&&_.m(n,null),g(n,o),g(n,a),g(a,i),Q(m,i,null),g(i,s),g(a,r),g(a,c),Q(y,c,null),g(c,p),H(l,d,u),Q(k,l,u),H(l,L,u),H(l,E,u),ne(E,t[7].comment),t[25](E),I=!0,D||(T=[z(i,"click",t[12]),z(c,"click",t[16]),z(E,"input",t[24])],D=!0)},p(l,u){var O;u&72&&(e=l[3]||((O=Object.keys(l[6]))==null?void 0:O.length)),e?_?(_.p(l,u),u&72&&M(_,1)):(_=Ie(l),_.c(),M(_,1),_.m(n,o)):_&&(Ce(),V(_,1,1,()=>{_=null}),Pe()),u&64&&Y(a,"swapActive",Object.keys(l[6]).length);const A={};!h&&u&256&&(h=!0,A.isNegative=l[8],re(()=>h=!1)),!w&&u&128&&(w=!0,A.value=l[7].value,re(()=>w=!1)),!U&&u&2&&(U=!0,A.inputRef=l[1],re(()=>U=!1)),k.$set(A),u&128&&ne(E,l[7].comment)},i(l){I||(M(_),M(m.$$.fragment,l),M(y.$$.fragment,l),M(k.$$.fragment,l),I=!0)},o(l){V(_),V(m.$$.fragment,l),V(y.$$.fragment,l),V(k.$$.fragment,l),I=!1},d(l){l&&b(n),_&&_.d(),G(m),G(y),l&&b(d),G(k,l),l&&b(L),l&&b(E),t[25](null),D=!1,de(T)}}}function nt(t){let n,e,o;return{c(){n=B("textarea"),this.h()},l(a){n=P(a,"TEXTAREA",{id:!0,rows:!0,class:!0,placeholder:!0}),C(n).forEach(b),this.h()},h(){v(n,"id","comment-input"),v(n,"rows","7"),v(n,"class","textarea resize-none self-stretch leading-4 ease-linear"),v(n,"placeholder","Transaction values")},m(a,i){H(a,n,i),ne(n,t[9]),t[20](n),e||(o=z(n,"input",t[19]),e=!0)},p(a,i){i&512&&ne(n,a[9])},i:S,o:S,d(a){a&&b(n),t[20](null),e=!1,o()}}}function Ie(t){let n,e,o,a,i,m,s;return e=new Le({props:{size:"20",strokeWidth:"3"}}),{c(){n=B("button"),F(e.$$.fragment),o=ee(`
            Copy`),this.h()},l(r){n=P(r,"BUTTON",{class:!0});var c=C(n);K(e.$$.fragment,c),o=te(c,`
            Copy`),c.forEach(b),this.h()},h(){v(n,"class","text-dark inline-flex gap-2 items-center font-bold rounded-full py-2 px-2")},m(r,c){H(r,n,c),Q(e,n,null),g(n,o),i=!0,m||(s=z(n,"click",t[15]),m=!0)},p:S,i(r){i||(M(e.$$.fragment,r),r&&Ue(()=>{a||(a=ye(n,we,{duration:300},!0)),a.run(1)}),i=!0)},o(r){V(e.$$.fragment,r),r&&(a||(a=ye(n,we,{duration:300},!1)),a.run(0)),i=!1},d(r){r&&b(n),G(e),r&&a&&a.end(),m=!1,s()}}}function st(t){let n,e,o,a,i,m,s,r,c,y,p,d,k,h,w,U,L,E,I,D,T,_,W;o=new Qe({props:{envelope:t[10]}});let N={ctx:t,current:null,token:null,hasCatch:!1,pending:et,then:xe,catch:$e,value:30,blocks:[,,,]};be(i=t[5].transactions,N);const x=[nt,tt],R=[];function J(l,u){return l[4]?0:1}return r=J(t),c=R[r]=x[r](t),{c(){n=B("div"),e=B("span"),F(o.$$.fragment),a=j(),N.block.c(),m=j(),s=B("div"),c.c(),y=j(),p=B("div"),d=B("button"),k=ee("Back"),h=j(),w=B("button"),U=B("span"),L=ee("Remove"),E=j(),I=B("span"),D=ee("Add"),this.h()},l(l){n=P(l,"DIV",{class:!0});var u=C(n);e=P(u,"SPAN",{class:!0});var A=C(e);K(o.$$.fragment,A),A.forEach(b),a=q(u),N.block.l(u),m=q(u),s=P(u,"DIV",{class:!0});var O=C(s);c.l(O),y=q(O),p=P(O,"DIV",{class:!0});var f=C(p);d=P(f,"BUTTON",{class:!0});var ae=C(d);k=te(ae,"Back"),ae.forEach(b),h=q(f),w=P(f,"BUTTON",{class:!0});var Z=C(w);U=P(Z,"SPAN",{class:!0});var X=C(U);L=te(X,"Remove"),X.forEach(b),E=q(Z),I=P(Z,"SPAN",{class:!0});var se=C(I);D=te(se,"Add"),se.forEach(b),Z.forEach(b),f.forEach(b),O.forEach(b),u.forEach(b),this.h()},h(){v(e,"class","sticky top-4 z-10 col-start-2 col-end-12 my-4"),v(d,"class","w-22 btn btn-outline"),v(U,"class","swap-on"),v(I,"class","swap-off"),v(w,"class","w-22 btn swap btn-primary svelte-eb6yxb"),Y(w,"swapActive",t[8]&&!t[4]),v(p,"class","flex justify-around"),v(s,"class","sticky bottom-0 col-span-full mt-8 box-border flex flex-col space-y-4 rounded-t-3xl bg-base-100 p-6"),v(n,"class","layout-template-rows grid-layout min-h-full svelte-eb6yxb")},m(l,u){H(l,n,u),g(n,e),Q(o,e,null),g(n,a),N.block.m(n,N.anchor=null),N.mount=()=>n,N.anchor=m,g(n,m),g(n,s),R[r].m(s,null),g(s,y),g(s,p),g(p,d),g(d,k),g(p,h),g(p,w),g(w,U),g(U,L),g(w,E),g(w,I),g(I,D),T=!0,_||(W=[z(d,"click",t[14]),z(w,"click",t[13])],_=!0)},p(l,[u]){t=l;const A={};u&1024&&(A.envelope=t[10]),o.$set(A),N.ctx=t,u&32&&i!==(i=t[5].transactions)&&be(i,N)||Ve(N,t,u);let O=r;r=J(t),r===O?R[r].p(t,u):(Ce(),V(R[O],1,1,()=>{R[O]=null}),Pe(),c=R[r],c?c.p(t,u):(c=R[r]=x[r](t),c.c()),M(c,1),c.m(s,y)),u&272&&Y(w,"swapActive",t[8]&&!t[4])},i(l){T||(M(o.$$.fragment,l),M(N.block),M(c),T=!0)},o(l){V(o.$$.fragment,l);for(let u=0;u<3;u+=1){const A=N.blocks[u];V(A)}V(c),T=!1},d(l){l&&b(n),G(o),N.block.d(),N.token=null,N=null,R[r].d(),_=!1,de(W)}}}function at(t,n,e){let o,a,i,m;pe(t,Xe,f=>e(27,a=f)),pe(t,Ye,f=>e(17,i=f)),pe(t,Fe,f=>e(28,m=f));const{id:s}=m.params;let r=null,c=null,y=null,p=null,d=!1;const k=()=>{document==null||document.getElementById("comment-input").focus()},h=async()=>{await a.deleteTransactions(Object.keys(D),s),e(6,D={}),e(5,I=await I.refresh())},w=()=>{if(d){const f=ve.parse(W);e(9,W=""),e(4,d=!1),f==null||f.forEach(ie=>{var me=ie,{envelope:ae,value:Z,date:X}=me,se=fe(me,["envelope","value","date"]);a.saveTransaction(ce(ue({},se),{value:Z*100,date:ke.fromFormat(X,Ee).toSeconds()}),s).then(async()=>{e(6,D={}),e(5,I=await I.refresh())})});return}He()&&T.value&&a.saveTransaction(T,s).then(async f=>{e(7,T.value=0,T),e(7,T.comment="",T),e(5,I=await I.refresh()),y==null||y.focus(),e(3,p=f),e(6,D={})})},U=()=>{if(d){e(4,d=!1);return}window.history.back()},L=()=>{const f=p?[p]:Object.values(D);navigator.clipboard.writeText(ve.stringify(f.map(se=>{var ie=se,{envelopeId:ae,_id:Z}=ie,X=fe(ie,["envelopeId","_id"]);return ce(ue({envelope:o==null?void 0:o.name},X),{value:X.value/100,date:ke.fromSeconds(X.date).toFormat(Ee)})}))).then(()=>{e(3,p=null),e(6,D={})}).catch(console.error)},E=async()=>{e(4,d=!0),r==null||r.focus()};let I=a?a.getTransactionsPaginated({actions:a,envelopeId:s}):{},D={},T={value:0,comment:""},_=!0,W="";function N(f){D=f,e(6,D)}function x(){W=this.value,e(9,W)}function R(f){$[f?"unshift":"push"](()=>{r=f,e(2,r)})}function J(f){_=f,e(8,_)}function l(f){t.$$.not_equal(T.value,f)&&(T.value=f,e(7,T))}function u(f){y=f,e(1,y)}function A(){T.comment=this.value,e(7,T)}function O(f){$[f?"unshift":"push"](()=>{c=f,e(0,c)})}return t.$$.update=()=>{t.$$.dirty&131072&&e(10,o=i.find(({_id:f})=>f===s)||{}),t.$$.dirty&3},[c,y,r,p,d,I,D,T,_,W,o,k,h,w,U,L,E,i,N,x,R,J,l,u,A,O]}class pt extends Ne{constructor(n){super();Ae(this,n,at,st,Be,{})}}export{pt as default};
