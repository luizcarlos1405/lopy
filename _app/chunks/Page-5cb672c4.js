var K=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var D=(e,t,s)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,w=(e,t)=>{for(var s in t||(t={}))P.call(t,s)&&D(e,s,t[s]);if(O)for(var s of O(t))k.call(t,s)&&D(e,s,t[s]);return e},C=(e,t)=>Q(e,W(t));var R=(e,t)=>{var s={};for(var n in e)P.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&O)for(var n of O(e))t.indexOf(n)<0&&k.call(e,n)&&(s[n]=e[n]);return s};import{X,Y as Z,D as G,Z as M,_ as ee,$ as te,S as se,i as ne,s as ae,F as oe,e as y,w as H,k as j,c as T,a as E,x as V,d as v,m as z,b as A,a0 as B,g as Y,H as S,y as L,M as I,q as _,o as N,B as U,V as re,I as ie,J as le,K as ce,n as ue,p as de,a1 as ge,a2 as pe,Q as ve,a3 as fe,a4 as he,a5 as _e,a6 as me}from"./vendor-b7281c58.js";import{c as f}from"./singletons-d1fb5791.js";const Ne=e=>e.replace(/[^\d]/g,""),Oe=(e,{showSign:t=!0}={})=>{const s=t&&Math.sign(e)<0?"-":"",n=Math.abs(e),i=Math.floor(n/100),l=n-i*100,d=`${i}`.split("").reduceRight((a,u,o,g)=>{const b=g.length,h=b-o,J=h&&h!==b&&h%3===0;return a[0]=`${u}${a[0]}`,J?["",...a]:a},[""]).join("."),c=`${l}`.padStart(2,"0");return`R$${s}${d},${c}`},Be=(e,t,s)=>{if(t<0||t>=e.length||s<0||s>=e.length){console.warn("Tried to move elements from out of bounds index:",{array:e,fromIndex:t,toIndex:s});return}const n=[...e],i=n[t];return n.splice(t,1),n.splice(s,0,i),n},x=()=>typeof window!="undefined",be=G([]);let r;const p=()=>r.envelopes.orderBy("order").toArray().then(e=>{console.log("dbEnvelopes",e),be.set(e)});x()&&(r=new X("lopy"),r.version(2).stores({envelopes:"_id,order",transactions:"_id,envelopeId,date"}),console.log("db",r),r.envelopes.toCollection().toArray().then(e=>console.log("envelopes",e)),r.transactions.toCollection().toArray().then(e=>console.log("transactions",e)),p());const Ce=Z(x()&&{saveEnvelope:async s=>{var n=s,{_id:e}=n,t=R(n,["_id"]);const i=await r.envelopes.count();return e?r.envelopes.update(e,t).then(p):r.envelopes.add(w({_id:M(),order:i,value:0},t)).then(p)},deleteEnvelope:({_id:e})=>r.envelopes.where({_id:e}).delete().then(p),reorderEnvelopes:async e=>{r.transaction("rw",r.envelopes,async()=>e.map(({_id:t},s)=>r.envelopes.update(t,{order:s}))).then(p)},saveTransaction:(e,t)=>new Promise((s,n)=>{console.log("saving transaction",e);const i=w({_id:M(),envelopeId:t,date:ee.now().toSeconds()},e);r.transaction("rw",r.transactions,r.envelopes,async()=>{const l=await r.envelopes.get(t);await r.transactions.add(i),await r.envelopes.update(t,{value:l.value+e.value})}).then(()=>{s(i),p()}).catch(n)}),getTransactionsPaginated:({actions:e,envelopeId:t,limit:s,offset:n})=>({transactions:r.transactions.where({envelopeId:t}).reverse().sortBy("date"),previous:()=>{},next:()=>{},refresh:async()=>{const i=e.getTransactionsPaginated({actions:e,envelopeId:t,limit:s,offset:n}),l=await i.transactions;return C(w({},i),{transactions:l})}}),getAllTransactionsPaginated:({actions:e,limit:t,offset:s})=>({transactions:r.transactions.reverse().sortBy("date"),previous:()=>{},next:()=>{},refresh:async()=>{const n=e.getAllTransactionsPaginated({actions:e,limit:t,offset:s}),i=await n.transactions;return C(w({},n),{transactions:i})}}),deleteTransactions:async(e,t)=>r.transaction("rw",r.transactions,r.envelopes,async()=>{console.log("transactionIds",e);const s=await r.envelopes.get(t),i=await r.transactions.where("_id").anyOf(e).toArray();console.log("dbTransactions",i);const l=i.reduce((d,{value:c})=>d-c,s.value);await r.envelopes.update(t,{value:l}),await r.transactions.bulkDelete(e).then(d=>console.log("transactions deleted",d))}).then(p)});f.disable_scroll_handling;const q=f.goto;f.invalidate;f.prefetch;f.prefetch_routes;f.before_navigate;f.after_navigate;const $="/",De="d/LL/yyyy HH:mm:ss",m={HOME:`${$}`,ENVELOPES:`${$}envelopes`,ENVELOPE:`${$}envelope`,EDIT:`${$}envelope/edit`,TRANSACTIONS:`${$}transactions`},we=()=>{const e=te("__svelte__");return{page:{subscribe:e.page.subscribe},navigating:{subscribe:e.navigating.subscribe},get preloading(){return console.error("stores.preloading is deprecated; use stores.navigating instead"),{subscribe:e.navigating.subscribe}},session:e.session,updated:e.updated}},$e={subscribe(e){return we().page.subscribe(e)}};function F(e){let t,s,n,i,l,d,c,a,u;return n=new fe({props:{size:"30"}}),d=new he({props:{size:"30"}}),{c(){t=y("div"),s=y("button"),H(n.$$.fragment),i=j(),l=y("button"),H(d.$$.fragment),this.h()},l(o){t=T(o,"DIV",{class:!0});var g=E(t);s=T(g,"BUTTON",{class:!0});var b=E(s);V(n.$$.fragment,b),b.forEach(v),i=z(g),l=T(g,"BUTTON",{class:!0});var h=E(l);V(d.$$.fragment,h),h.forEach(v),g.forEach(v),this.h()},h(){A(s,"class","btn btn-ghost text-base-content relative svelte-1aw46ng"),B(s,"currentButton",e[1].url.pathname==m.HOME),A(l,"class","btn btn-ghost text-base-content relative svelte-1aw46ng"),B(l,"currentButton",e[1].url.pathname==m.TRANSACTIONS),A(t,"class","inline-flex justify-evenly sticky mx-4 bottom-6 p-2 bg-base-100 rounded-3xl")},m(o,g){Y(o,t,g),S(t,s),L(n,s,null),S(t,i),S(t,l),L(d,l,null),c=!0,a||(u=[I(s,"click",e[4]),I(l,"click",e[5])],a=!0)},p(o,g){g&2&&B(s,"currentButton",o[1].url.pathname==m.HOME),g&2&&B(l,"currentButton",o[1].url.pathname==m.TRANSACTIONS)},i(o){c||(_(n.$$.fragment,o),_(d.$$.fragment,o),c=!0)},o(o){N(n.$$.fragment,o),N(d.$$.fragment,o),c=!1},d(o){o&&v(t),U(n),U(d),a=!1,re(u)}}}function ye(e){let t,s,n,i,l;const d=e[3].default,c=oe(d,e,e[2],null);let a=!e[0]&&F(e);return{c(){t=y("div"),s=y("div"),c&&c.c(),i=j(),a&&a.c(),this.h()},l(u){t=T(u,"DIV",{class:!0});var o=E(t);s=T(o,"DIV",{class:!0});var g=E(s);c&&c.l(g),g.forEach(v),i=z(o),a&&a.l(o),o.forEach(v),this.h()},h(){A(s,"class","relative max-w-md h-full flex-grow flex flex-col"),A(t,"class","flex p-4 flex-col align-stretch w-full min-h-screen max-w-lg mx-auto")},m(u,o){Y(u,t,o),S(t,s),c&&c.m(s,null),S(t,i),a&&a.m(t,null),l=!0},p(u,[o]){e=u,c&&c.p&&(!l||o&4)&&ie(c,d,e,e[2],l?ce(d,e[2],o,null):le(e[2]),null),e[0]?a&&(ue(),N(a,1,1,()=>{a=null}),de()):a?(a.p(e,o),o&1&&_(a,1)):(a=F(e),a.c(),_(a,1),a.m(t,null))},i(u){l||(_(c,u),n||ge(()=>{n=pe(s,me,{y:-1e3,duration:500,start:.95,easing:_e}),n.start()}),_(a),l=!0)},o(u){N(c,u),N(a),l=!1},d(u){u&&v(t),c&&c.d(u),a&&a.d()}}}function Te(e,t,s){let n;ve(e,$e,u=>s(1,n=u));let{$$slots:i={},$$scope:l}=t,{hideBottomNavigation:d=!1}=t;const c=()=>q(`${m.HOME}`),a=()=>q(`${m.TRANSACTIONS}`);return e.$$set=u=>{"hideBottomNavigation"in u&&s(0,d=u.hideBottomNavigation),"$$scope"in u&&s(2,l=u.$$scope)},[d,n,l,i,c,a]}class Pe extends se{constructor(t){super();ne(this,t,Te,ye,ae,{hideBottomNavigation:0})}}export{De as C,Pe as P,m as R,Ce as a,be as e,Oe as f,q as g,x as i,Be as m,$e as p,Ne as s};
