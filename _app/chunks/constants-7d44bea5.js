var e=Object.defineProperty,s=Object.defineProperties,n=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(s,n,t)=>n in s?e(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,l=(e,s)=>{for(var n in s||(s={}))o.call(s,n)&&r(e,n,s[n]);if(t)for(var n of t(s))a.call(s,n)&&r(e,n,s[n]);return e};import{S as c,i,s as d,D as p,e as u,c as v,a as f,d as h,b as g,f as y,G as m,H as w,I as $,x as b,u as x,T as E,U as O,C as I,V as P,W as _,X as j,Y as T,Z as D,_ as S}from"./vendor-c8af0afa.js";import{r as V}from"./singletons-12a22614.js";function k(e){let s,n;const t=e[1].default,o=p(t,e,e[0],null);return{c(){s=u("div"),o&&o.c(),this.h()},l(e){s=v(e,"DIV",{class:!0});var n=f(s);o&&o.l(n),n.forEach(h),this.h()},h(){g(s,"class","z-50 flex items-center flex-nowrap font-base sticky top-2 mx-2 mt-2 px-4 py-3 shadow-md box-border rounded-full rounded-full bg-background-dark")},m(e,t){y(e,s,t),o&&o.m(s,null),n=!0},p(e,[s]){o&&o.p&&(!n||1&s)&&m(o,t,e,e[0],n?$(t,e[0],s,null):w(e[0]),null)},i(e){n||(b(o,e),n=!0)},o(e){x(o,e),n=!1},d(e){e&&h(s),o&&o.d(e)}}}function A(e,s,n){let{$$slots:t={},$$scope:o}=s;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,t]}class C extends c{constructor(e){super(),i(this,e,A,k,d,{})}}const H=e=>e.replace(/[^\d]/g,""),L=(e,{showSign:s=!0}={})=>{const n=s&&Math.sign(e)<0?"-":"",t=Math.abs(e),o=Math.floor(t/100),a=t-100*o;return`R$${n}${`${o}`.split("").reduceRight(((e,s,n,t)=>{const o=t.length,a=o-n,r=a&&a!==o&&a%3==0;return e[0]=`${s}${e[0]}`,r?["",...e]:e}),[""]).join(".")},${`${a}`.padStart(2,"0")}`},M=(e,s,n)=>{if(s<0||s>=e.length||n<0||n>=e.length)return void console.warn("Tried to move elements from out of bounds index:",{array:e,fromIndex:s,toIndex:n});const t=[...e],o=t[s];return t.splice(s,1),t.splice(n,0,o),t},R=()=>"undefined"!=typeof window,B=I([]);let N;const z=()=>N.envelopes.orderBy("order").toArray().then((e=>{console.log("dbEnvelopes",e),B.set(e)}));R()&&(N=new E("lopy"),N.version(2).stores({envelopes:"_id,order",transactions:"_id,envelopeId,date"}),console.log("db",N),N.envelopes.toCollection().toArray().then((e=>console.log("envelopes",e))),N.transactions.toCollection().toArray().then((e=>console.log("transactions",e))),z());const G=O(R()&&{saveEnvelope:async e=>{var s=e,{_id:n}=s,r=((e,s)=>{var n={};for(var r in e)o.call(e,r)&&s.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&t)for(var r of t(e))s.indexOf(r)<0&&a.call(e,r)&&(n[r]=e[r]);return n})(s,["_id"]);const c=await N.envelopes.count();return n?N.envelopes.update(n,r).then(z):N.envelopes.add(l({_id:P(),order:c,value:0},r)).then(z)},deleteEnvelope:({_id:e})=>N.envelopes.where({_id:e}).delete().then(z),reorderEnvelopes:async e=>{N.transaction("rw",N.envelopes,(async()=>e.map((({_id:e},s)=>N.envelopes.update(e,{order:s}))))).then(z)},saveTransaction:(e,s)=>new Promise(((n,t)=>{console.log("saving transaction",e);const o=l({_id:P(),envelopeId:s,date:_.now().toSeconds()},e);N.transaction("rw",N.transactions,N.envelopes,(async()=>{const n=await N.envelopes.get(s);await N.transactions.add(o),await N.envelopes.update(s,{value:n.value+e.value})})).then((()=>{n(o),z()})).catch(t)})),getTransactionsPaginated:({actions:e,envelopeId:t,limit:o,offset:a})=>(console.log("db.transactions",N.transactions),{transactions:N.transactions.where({envelopeId:t}).reverse().sortBy("date"),previous:()=>{},next:()=>{},refresh:async()=>{const r=e.getTransactionsPaginated({actions:e,envelopeId:t,limit:o,offset:a}),c=await r.transactions;return i=l({},r),s(i,n({transactions:c}));var i}}),deleteTransactions:async(e,s)=>N.transaction("rw",N.transactions,N.envelopes,(async()=>{console.log("transactionIds",e);const n=await N.envelopes.get(s),t=N.transactions.where("_id").anyOf(e),o=await t.toArray();console.log("dbTransactions",o);const a=o.reduce(((e,{value:s})=>e-s),n.value);await N.envelopes.update(s,{value:a}),await N.transactions.bulkDelete(e).then((e=>console.log("transactions deleted",e)))})).then(z)}),U=V,W=async function(e,s){return U.goto(e,s,[])};function X(e){let s,n,t;const o=e[1].default,a=p(o,e,e[0],null);return{c(){s=u("div"),a&&a.c(),this.h()},l(e){s=v(e,"DIV",{class:!0});var n=f(s);a&&a.l(n),n.forEach(h),this.h()},h(){g(s,"class","relative max-w-md min-h-full flex-grow mx-auto flex flex-col")},m(e,n){y(e,s,n),a&&a.m(s,null),t=!0},p(s,[n]){e=s,a&&a.p&&(!t||1&n)&&m(a,o,e,e[0],t?$(o,e[0],n,null):w(e[0]),null)},i(e){t||(b(a,e),n||j((()=>{n=T(s,S,{y:-1e3,duration:800,start:.95,easing:D}),n.start()})),t=!0)},o(e){x(a,e),t=!1},d(e){e&&h(s),a&&a.d(e)}}}function Y(e,s,n){let{$$slots:t={},$$scope:o}=s;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,t]}class Z extends c{constructor(e){super(),i(this,e,Y,X,d,{})}}const q="d/LL/yyyy HH:mm:ss",F={HOME:"/",ENVELOPES:"/envelopes",ENVELOPE:"/envelope",EDIT:"/envelope/edit"};export{q as C,Z as P,F as R,C as T,G as a,B as e,L as f,W as g,R as i,M as m,H as s};
