var D=Object.defineProperty,P=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var y=(e,t,s)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,d=(e,t)=>{for(var s in t||(t={}))m.call(t,s)&&y(e,s,t[s]);if(u)for(var s of u(t))E.call(t,s)&&y(e,s,t[s]);return e},b=(e,t)=>P(e,O(t));var T=(e,t)=>{var s={};for(var n in e)m.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&u)for(var n of u(e))t.indexOf(n)<0&&E.call(e,n)&&(s[n]=e[n]);return s};import{c}from"./singletons-d1fb5791.js";import{W as R,a2 as M,a3 as L,D as N,a4 as f,a5 as B}from"./vendor-a2c2caf4.js";const W=e=>e.replace(/[^\d]/g,""),j=(e,{showSign:t=!0}={})=>{const s=t&&Math.sign(e)<0?"-":"",n=Math.abs(e),a=Math.floor(n/100),r=Math.floor(n-a*100),l=`${a}`.split("").reduceRight((g,A,$,C)=>{const w=C.length,h=w-$,S=h&&h!==w&&h%3===0;return g[0]=`${A}${g[0]}`,S?["",...g]:g},[""]).join("."),v=`${r}`.padStart(2,"0");return`R$${s}${l},${v}`},k=(e,t,s)=>{if(t<0||t>=e.length||s<0||s>=e.length){console.warn("Tried to move elements from out of bounds index:",{array:e,fromIndex:t,toIndex:s});return}const n=[...e],a=n[t];return n.splice(t,1),n.splice(s,0,a),n},_=()=>typeof window!="undefined";c.disable_scroll_handling;const Y=c.goto;c.invalidate;c.prefetch;c.prefetch_routes;c.before_navigate;c.after_navigate;const p="/",q="d/LL/yyyy HH:mm:ss",z={HOME:`${p}`,ENVELOPES:`${p}envelopes`,ENVELOPE:`${p}envelope`,EDIT:`${p}envelope/edit`,TRANSACTIONS:`${p}transactions`},H=()=>{const e=R("__svelte__");return{page:{subscribe:e.page.subscribe},navigating:{subscribe:e.navigating.subscribe},get preloading(){return console.error("stores.preloading is deprecated; use stores.navigating instead"),{subscribe:e.navigating.subscribe}},session:e.session,updated:e.updated}},G={subscribe(e){return H().page.subscribe(e)}},V=N([]);let o;const i=()=>o.envelopes.orderBy("order").toArray().then(e=>{console.log("dbEnvelopes",e),V.set(e)});_()&&(o=new M("lopy"),o.version(2).stores({envelopes:"_id,order",transactions:"_id,envelopeId,date"}),console.log("db",o),o.envelopes.toCollection().toArray().then(e=>console.log("envelopes",e)),o.transactions.toCollection().toArray().then(e=>console.log("transactions",e)),i());const J=L(_()&&{saveEnvelope:async s=>{var n=s,{_id:e}=n,t=T(n,["_id"]);const a=await o.envelopes.count();return e?o.envelopes.update(e,t).then(i):o.envelopes.add(d({_id:f(),order:a,value:0},t)).then(i)},deleteEnvelope:({_id:e})=>o.envelopes.where({_id:e}).delete().then(i),reorderEnvelopes:async e=>{o.transaction("rw",o.envelopes,async()=>e.map(({_id:t},s)=>o.envelopes.update(t,{order:s}))).then(i)},saveTransaction:(e,t)=>new Promise((s,n)=>{console.log("saving transaction",e);const a=d({_id:f(),envelopeId:t,date:B.now().toSeconds()},e);o.transaction("rw",o.transactions,o.envelopes,async()=>{const r=await o.envelopes.get(t);await o.transactions.add(a),await o.envelopes.update(t,{value:r.value+e.value})}).then(()=>{s(a),i()}).catch(n)}),getTransactionsPaginated:({actions:e,envelopeId:t,limit:s,offset:n})=>({transactions:o.transactions.where({envelopeId:t}).reverse().sortBy("date"),previous:()=>{},next:()=>{},refresh:async()=>{const a=e.getTransactionsPaginated({actions:e,envelopeId:t,limit:s,offset:n}),r=await a.transactions;return b(d({},a),{transactions:r})}}),getAllTransactionsPaginated:({actions:e,limit:t,offset:s})=>({transactions:o.transactions.reverse().sortBy("date"),previous:()=>{},next:()=>{},refresh:async()=>{const n=e.getAllTransactionsPaginated({actions:e,limit:t,offset:s}),a=await n.transactions;return b(d({},n),{transactions:a})}}),deleteTransactions:async(e,t)=>o.transaction("rw",o.transactions,o.envelopes,async()=>{console.log("transactionIds",e);const s=await o.envelopes.get(t),a=await o.transactions.where("_id").anyOf(e).toArray();console.log("dbTransactions",a);const r=a.reduce((l,{value:v})=>l-v,s.value);await o.envelopes.update(t,{value:r}),await o.transactions.bulkDelete(e).then(l=>console.log("transactions deleted",l))}).then(i)});export{q as C,z as R,J as a,V as e,j as f,Y as g,_ as i,k as m,G as p,W as s};
