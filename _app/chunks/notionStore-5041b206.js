var G=Object.defineProperty,K=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var R=(a,e,t)=>e in a?G(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,k=(a,e)=>{for(var t in e||(e={}))Q.call(e,t)&&R(a,t,e[t]);if(J)for(var t of J(e))W.call(e,t)&&R(a,t,e[t]);return a},O=(a,e)=>K(a,L(e));import{S as X,i as $,s as ee,e as b,w as te,c as _,a as g,x as ae,d as m,b as h,g as Y,y as se,T as Z,Y as oe,N as ne,q as w,o as P,B as re,t as q,k as B,h as x,m as C,H as u,j as N,n as le,p as ie,Z as ce,_ as pe,D as de}from"./vendor-4d7ef4b9.js";import{f as U,g as ue,R as fe}from"./stores-34ec517f.js";function M(a){let e,t,r,o,n;return t=new ce({props:{size:"16"}}),{c(){e=b("button"),te(t.$$.fragment),this.h()},l(s){e=_(s,"BUTTON",{class:!0});var i=g(e);ae(t.$$.fragment,i),i.forEach(m),this.h()},h(){h(e,"class","btn btn-ghost btn-circle btn-sm ml-auto opacity-80")},m(s,i){Y(s,e,i),se(t,e,null),r=!0,o||(n=Z(e,"click",oe(a[5])),o=!0)},p:ne,i(s){r||(w(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&m(e),re(t),o=!1,n()}}}function he(a){let e,t,r=(a[4]||"\u2709\uFE0F")+"",o,n,s,i,v,y,d,E=U(a[2])+"",D,S,f,j,V,l=!a[0].url&&M(a);return{c(){e=b("div"),t=b("div"),o=q(r),n=B(),s=b("div"),i=b("div"),v=q(a[3]),y=B(),d=b("div"),D=q(E),S=B(),l&&l.c(),this.h()},l(c){e=_(c,"DIV",{id:!0,class:!0});var p=g(e);t=_(p,"DIV",{class:!0});var z=g(t);o=x(z,r),z.forEach(m),n=C(p),s=_(p,"DIV",{class:!0});var T=g(s);i=_(T,"DIV",{class:!0});var H=g(i);v=x(H,a[3]),H.forEach(m),y=C(T),d=_(T,"DIV",{class:!0});var A=g(d);D=x(A,E),A.forEach(m),T.forEach(m),S=C(p),l&&l.l(p),p.forEach(m),this.h()},h(){h(t,"class","flex h-12 w-12 flex-shrink-0 items-center justify-center self-center rounded-2xl bg-base-200 bg-opacity-80 p-1 text-4xl"),h(i,"class","truncate text-base"),h(d,"class","font-mono text-sm opacity-70"),h(s,"class","mx-2 flex flex-col justify-center truncate font-semibold"),h(e,"id",a[1]),h(e,"class","border-box flex items-center overflow-visible rounded-3xl bg-base-100 p-2 text-base-content")},m(c,p){Y(c,e,p),u(e,t),u(t,o),u(e,n),u(e,s),u(s,i),u(i,v),u(s,y),u(s,d),u(d,D),u(e,S),l&&l.m(e,null),f=!0,j||(V=Z(e,"click",a[6]),j=!0)},p(c,[p]){(!f||p&16)&&r!==(r=(c[4]||"\u2709\uFE0F")+"")&&N(o,r),(!f||p&8)&&N(v,c[3]),(!f||p&4)&&E!==(E=U(c[2])+"")&&N(D,E),c[0].url?l&&(le(),P(l,1,1,()=>{l=null}),ie()):l?(l.p(c,p),p&1&&w(l,1)):(l=M(c),l.c(),w(l,1),l.m(e,null)),(!f||p&2)&&h(e,"id",c[1])},i(c){f||(w(l),f=!0)},o(c){P(l),f=!1},d(c){c&&m(e),l&&l.d(),j=!1,V()}}}function me(a,e,t){let r,o,n,s,{envelope:i}=e;console.log(i);const v=()=>{ue(`${fe.EDIT}/${r}`)};function y(d){pe.call(this,a,d)}return a.$$set=d=>{"envelope"in d&&t(0,i=d.envelope)},a.$$.update=()=>{a.$$.dirty&1&&t(1,{_id:r,emoji:o,name:n,value:s}=i,r,(t(4,o),t(0,i)),(t(3,n),t(0,i)),(t(2,s),t(0,i)))},[i,r,s,n,o,v,y]}class ye extends X{constructor(e){super();$(this,e,me,he,ee,{envelope:0})}}const I={token:localStorage.getItem("token"),pageId:localStorage.getItem("pageId"),transactionsDatabaseId:localStorage.getItem("transactionsDatabaseId"),envelopesDatabaseId:localStorage.getItem("envelopesDatabaseId")},F=de({envelopes:[]}),ve=async()=>{const a=new Headers;a.append("procedure","listEnvelopes"),a.append("Authorization",`Bearer ${I.token}`),a.append("Content-Type","application/json");const e=JSON.stringify({envelopesDatabaseId:I.envelopesDatabaseId}),r=await fetch("http://localhost:8000/api/notion-procedures",{method:"POST",headers:a,body:e}).then(o=>o.json()).catch(o=>(console.error(o),[]));F.update(o=>O(k({},o),{envelopes:r}))},be=async({envelopeId:a})=>{const e=new Headers;e.append("procedure","listEnvelopeTransactions"),e.append("Authorization",`Bearer ${I.token}`),e.append("Content-Type","application/json");const t=JSON.stringify({transactionsDatabaseId:I.transactionsDatabaseId,envelopePageId:a}),o=await fetch("http://localhost:8000/api/notion-procedures",{method:"POST",headers:e,body:t}).then(n=>n.json()).catch(n=>(console.error(n),[]));F.update(n=>O(k({},n),{transactionsByEnvelopeId:O(k({},n.transactionsByEnvelopeId),{[a]:o})}))},Ee=async({envelopeId:a,transaction:e})=>{const t=new Headers;t.append("procedure","addTransaction"),t.append("Authorization",`Bearer ${I.token}`),t.append("Content-Type","application/json");const r=JSON.stringify({transactionsDatabaseId:I.transactionsDatabaseId,envelopePageId:a,description:e.comment||"",value:e.value/100});await fetch("http://localhost:8000/api/notion-procedures",{method:"POST",headers:t,body:r}).then(n=>n.json()).catch(n=>(console.error(n),[])),await ve(),await be({envelopeId:a})};export{ye as E,be as a,ve as f,F as n,Ee as s};
