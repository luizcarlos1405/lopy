var G=Object.defineProperty,K=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var R=(a,e,t)=>e in a?G(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,k=(a,e)=>{for(var t in e||(e={}))Q.call(e,t)&&R(a,t,e[t]);if(J)for(var t of J(e))W.call(e,t)&&R(a,t,e[t]);return a},w=(a,e)=>K(a,L(e));import{S as X,i as $,s as ee,e as _,w as te,c as g,a as I,x as ae,d as v,b as m,g as Y,y as ne,T as Z,Y as oe,N as se,q as S,o as P,B as ie,t as B,k as x,h as q,m as C,H as u,j as N,n as re,p as le,Z as ce,_ as pe,D as de}from"./vendor-4d7ef4b9.js";import{f as U,g as ue,R as fe}from"./stores-34ec517f.js";function M(a){let e,t,s,n,i;return t=new ce({props:{size:"16"}}),{c(){e=_("button"),te(t.$$.fragment),this.h()},l(o){e=g(o,"BUTTON",{class:!0});var l=I(e);ae(t.$$.fragment,l),l.forEach(v),this.h()},h(){m(e,"class","btn btn-ghost btn-circle btn-sm ml-auto opacity-80")},m(o,l){Y(o,e,l),ne(t,e,null),s=!0,n||(i=Z(e,"click",oe(a[5])),n=!0)},p:se,i(o){s||(S(t.$$.fragment,o),s=!0)},o(o){P(t.$$.fragment,o),s=!1},d(o){o&&v(e),ie(t),n=!1,i()}}}function he(a){let e,t,s=(a[4]||"\u2709\uFE0F")+"",n,i,o,l,b,E,d,y=U(a[2])+"",D,O,h,j,V,r=!a[0].url&&M(a);return{c(){e=_("div"),t=_("div"),n=B(s),i=x(),o=_("div"),l=_("div"),b=B(a[3]),E=x(),d=_("div"),D=B(y),O=x(),r&&r.c(),this.h()},l(c){e=g(c,"DIV",{id:!0,class:!0});var p=I(e);t=g(p,"DIV",{class:!0});var z=I(t);n=q(z,s),z.forEach(v),i=C(p),o=g(p,"DIV",{class:!0});var T=I(o);l=g(T,"DIV",{class:!0});var H=I(l);b=q(H,a[3]),H.forEach(v),E=C(T),d=g(T,"DIV",{class:!0});var A=I(d);D=q(A,y),A.forEach(v),T.forEach(v),O=C(p),r&&r.l(p),p.forEach(v),this.h()},h(){m(t,"class","flex h-12 w-12 flex-shrink-0 items-center justify-center self-center rounded-2xl bg-base-200 bg-opacity-80 p-1 text-4xl"),m(l,"class","truncate text-base"),m(d,"class","font-mono text-sm opacity-70"),m(o,"class","mx-2 flex flex-col justify-center truncate font-semibold"),m(e,"id",a[1]),m(e,"class","border-box flex items-center overflow-visible rounded-3xl bg-base-100 p-2 text-base-content")},m(c,p){Y(c,e,p),u(e,t),u(t,n),u(e,i),u(e,o),u(o,l),u(l,b),u(o,E),u(o,d),u(d,D),u(e,O),r&&r.m(e,null),h=!0,j||(V=Z(e,"click",a[6]),j=!0)},p(c,[p]){(!h||p&16)&&s!==(s=(c[4]||"\u2709\uFE0F")+"")&&N(n,s),(!h||p&8)&&N(b,c[3]),(!h||p&4)&&y!==(y=U(c[2])+"")&&N(D,y),c[0].url?r&&(re(),P(r,1,1,()=>{r=null}),le()):r?(r.p(c,p),p&1&&S(r,1)):(r=M(c),r.c(),S(r,1),r.m(e,null)),(!h||p&2)&&m(e,"id",c[1])},i(c){h||(S(r),h=!0)},o(c){P(r),h=!1},d(c){c&&v(e),r&&r.d(),j=!1,V()}}}function me(a,e,t){let s,n,i,o,{envelope:l}=e;console.log(l);const b=()=>{ue(`${fe.EDIT}/${s}`)};function E(d){pe.call(this,a,d)}return a.$$set=d=>{"envelope"in d&&t(0,l=d.envelope)},a.$$.update=()=>{a.$$.dirty&1&&t(1,{_id:s,emoji:n,name:i,value:o}=l,s,(t(4,n),t(0,l)),(t(3,i),t(0,l)),(t(2,o),t(0,l)))},[l,s,o,i,n,b,E]}class Ee extends X{constructor(e){super();$(this,e,me,he,ee,{envelope:0})}}const f={token:localStorage.getItem("token"),pageId:localStorage.getItem("pageId"),transactionsDatabaseId:localStorage.getItem("transactionsDatabaseId"),envelopesDatabaseId:localStorage.getItem("envelopesDatabaseId"),apiEndpoint:"https://lopy-notion-api.deno.dev/api/"},F=de({envelopes:[]}),ve=async()=>{const a=new Headers;a.append("procedure","listEnvelopes"),a.append("Authorization",`Bearer ${f.token}`),a.append("Content-Type","application/json");const e=JSON.stringify({envelopesDatabaseId:f.envelopesDatabaseId}),t={method:"POST",headers:a,body:e},s=await fetch(`${f.apiEndpoint}notion-procedures`,t).then(n=>n.json()).catch(n=>(console.error(n),[]));F.update(n=>w(k({},n),{envelopes:s}))},be=async({envelopeId:a})=>{const e=new Headers;e.append("procedure","listEnvelopeTransactions"),e.append("Authorization",`Bearer ${f.token}`),e.append("Content-Type","application/json");const t=JSON.stringify({transactionsDatabaseId:f.transactionsDatabaseId,envelopePageId:a}),s={method:"POST",headers:e,body:t},n=await fetch(`${f.apiEndpoint}notion-procedures`,s).then(i=>i.json()).catch(i=>(console.error(i),[]));F.update(i=>w(k({},i),{transactionsByEnvelopeId:w(k({},i.transactionsByEnvelopeId),{[a]:n})}))},ye=async({envelopeId:a,transaction:e})=>{const t=new Headers;t.append("procedure","addTransaction"),t.append("Authorization",`Bearer ${f.token}`),t.append("Content-Type","application/json");const s=JSON.stringify({transactionsDatabaseId:f.transactionsDatabaseId,envelopePageId:a,description:e.comment||"",value:e.value/100}),n={method:"POST",headers:t,body:s};await fetch(`${f.apiEndpoint}notion-procedures`,n).then(i=>i.json()).catch(i=>(console.error(i),[])),await ve(),await be({envelopeId:a})};export{Ee as E,be as a,ve as f,F as n,ye as s};
